<% include ../../cfg/envpath.ejs %>
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>
		登录
	</title>
	<script type="text/javascript" src='/webrexco/static/js/cmn/rexco-0.1.min.js'></script>
	<style>
		/* reset */
		body,textarea,input,button,select,keygen,legend{ font: 12px/1.5 "微软雅黑",Arial,"Microsoft YaHei","Open Sans","Hiragino Sans GB","STHeiti","WenQuanYi Micro Hei",SimSun,sans-serif,tahoma,arial,"Hiragino Sans GB","宋体",sans-serif;  background:#fff; }
		html,body,h1,h2,h3,h4,h5,h6,div,dl,dt,dd,ul,ol,li,p,blockquote,pre,hr,figure,table,caption,th,td,form,fieldset,legend,input,button,textarea,menu{margin:0;padding:0;outline:none;}
		header,footer,section,article,aside,nav,hgroup,address,figure,figcaption,menu,details{display:block;}
		table{border-collapse:collapse;border-spacing:0;overflow:hidden;word-break:break-all;}
		caption,th{text-align:left;font-weight:normal;}
		html,body,fieldset,img,iframe,abbr{border:0;}
		i,cite,em,var,address,dfn{font-style:normal;}
		[hidefocus],summary{outline:0;}
		ul,li{list-style:none;}
		h1,h2,h3,h4,h5,h6,small{font-size:100%;}
		sup,sub{font-size:83%;}
		pre,code,kbd,samp{font-family:inherit;}
		q:before,q:after{content:none;}
		textarea{overflow:auto;resize:none;}
		label,summary{cursor:default;}
		a,button{cursor:pointer;}
		del,ins,u,s,a,a:hover{text-decoration:none;}
		a{ text-decoration:none; outline:none;}/*去掉链接点击时出现的虚线框*/
		a:active{star:expression(this.onFocus=this.blur());}/*去掉链接点击时出现的虚线框---made by linwenshu*/
		input::-moz-focus-inner{border:none;}/*去掉按钮点击时出现的虚线框--------for */
		html, body{ margin:0; height:100%;width:100%; }/*解决height:100%无效的问题*/
		.f-cf:after,.clearfix:after{content: ".";display: block;height: 0;clear: both; visibility: hidden; font-size: 0;}
		/*function*/
		.ofh{overflow:hidden;}
		.wsn{white-space:nowrap;}
		.hide{display:none;}
		.f-fl{float:left;}
		.f-fr{float:right;}
		.cb{clear:both;}
		.inb{display:inline-block;}
		.tl{text-align:left;}
		.tc{text-align:center;}
		.pr{position:relative;}
		.pa{position:absolute;}
		.db{display:block;}
		input,img{vertical-align: middle;}
		.g-wp{width:370px;height:544px;}
		.m-con-loginHeader{width:294px;height:40px;line-height:38px;padding:16px 38px 0;border-bottom: 1px solid #d3d3d3;margin-bottom:29px;}
		.m-con-text{font-size:16px;color:#333;width:35px;border-bottom:3px solid #c8a676;font-weight: bold;}
		.m-con-iptContent{width:294px;margin:0 auto;position: relative;}
		.m-con-icon1{display: block;width:15px;height:14px;background: url(/webrexco/activity/login/img/loginIcon.png) no-repeat 0 0;position: absolute;top:14px;left:12px;}
		.m-con-icon2{display: block;width:14px;height:11px;background: url(/webrexco/activity/login/img/loginIcon.png) no-repeat -26px 0;position: absolute;top:14px;left:14px;}
		.m-con-icon3{display: block;width:13px;height:16px;background: url(/webrexco/activity/login/img/loginIcon.png) no-repeat -50px 0;position: absolute;top:14px;left:14px;}
		.m-con-input{padding-left:38px;width:256px;height:40px;line-height:40px;border:1px solid #d3d3d3;font-size:16px;}
		.m-con-input:focus{border-color: #c8a676;box-shadow: 0 0 5px #c8a676}
		.m-con-input.verif{width:136px;}
		.m-con-tipsMessage{height:28px;line-height: 28px;color:#c8a676;font-size: 12px;padding-left:13px;}
		.m-con-verifImg{width:114px;height:42px;}
		.m-con-loginBtn{width:294px;height:42px;background: #c8a676;font-size:16px;color:#fff;border:none;border-radius: 5px;text-align: center;letter-spacing: 12px;margin-bottom:22px;}
		.m-con-toRegist{float:left;color:#666;}
		.m-con-toFindPwd{color:#666;float:right;}
		.m-con-otherLogin{width:370px;height:136px;background: #f5f5f5;margin-top:30px;}
		.m-con-otherLoginTitle{padding-top:23px;color:#666;font-size:16px;}
		.m-con-line{float:left;width:87px;height:1px;background: #aeaeae;margin-top: 12px;}
		.m-con-qqLogin{display:block;float:left;width:21px;height:24px;background: url(/webrexco/activity/login/img/loginIcon.png) no-repeat 0 -48px;margin:20px 70px 0 40px;}
		.m-con-qqLogin:hover{background-position: 0 -21px}
		.m-con-wxLogin{display:block;float:left;width:26px;height:21px;background: url(/webrexco/activity/login/img/loginIcon.png) no-repeat -27px -48px;margin-top:20px;}
		.m-con-wxLogin:hover{background-position: -27px -21px}
		.m-con-wbLogin{display:block;float:left;width:26px;height:21px;background: url(/webrexco/activity/login/img/loginIcon.png) no-repeat -63px -48px;margin:20px 40px 0 70px;}
		.m-con-wbLogin:hover{background-position: -63px -21px}
	</style>
</head>
<body>
	<div class="g-wp">
		<form name="login" id="login_form" method="post">
	    	<div class='m-con-loginHeader'>
	    		<p class='m-con-text'>登录</p>
	    	</div>
	    	<div class='m-con-iptContent'>
	    		<b class='m-con-icon1'></b>
	    		<input type="text" name="username" placeholder='用户名' class='J_con_username m-con-input'>
	    		<p class='m-con-tipsMessage'></p>
	    	</div>
	    	<div class='m-con-iptContent'>
	    		<b class='m-con-icon2'></b>
	    		<input type="password" name="password" placeholder='登录密码' class='J_con_password m-con-input'>
	    		<p class='m-con-tipsMessage'></p>
	    	</div>
	    	<div class='m-con-iptContent'>
	    		<b class='m-con-icon3'></b>
	    		<input type="text" name="valiCode" placeholder='图形验证码' class='J_con_verifCode m-con-input verif'>
	    		<img id="validimg" class="m-con-verifImg" src="login.cci?w=160&amp;h=40&amp;f=34&amp;o=60&amp;q=60" alt="点击刷新" onclick="this.src='login.cci?w=160&amp;h=40&amp;f=34&amp;o=60&amp;q=60&amp;t=' + Math.random();" align="absmiddle">
	    		<p class='m-con-tipsMessage' id='login_msg'></p>
	    	</div>
	    	<div class='m-con-iptContent'>
	    		<button class='m-con-loginBtn' type='button'>登&nbsp;录</button>
	    	</div>
	    	<div class='m-con-iptContent clearfix'>
	    		<p class='m-con-toRegist'>没有帐号？ <a style='color:#c8a676;' href="/webrexco/register.htm" target='_blank'>立即注册</a></p>
	    		<a class='m-con-toFindPwd' href="/webrexco/forgetPwd.htm" target='_blank'>忘记密码？</a>
	    	</div>
	    </form>
	    <div class='m-con-otherLogin'>
	    	<div class='m-con-iptContent'>
		    	<div class='m-con-otherLoginTitle clearfix'>
		    		<b class='m-con-line'></b><p class='f-fl' style='margin:0 20px'>第三方登录</p><b class='m-con-line'></b>
		    	</div>
		    	<div class='clearfix'>
		    		<a href="#" class='m-con-qqLogin oauth-qq'></a>
		    		<a href="#" class='m-con-wxLogin oauth-weixin'></a>
		    		<a href="#" class='m-con-wbLogin oauth-weibo'></a>
		    	</div>
	    	</div>
	    </div>
	</div>
    <script src="/webrexco/static/js/oauth.js"></script>
	<script type="text/javascript">
		function login(){
			var login=top.window.document.getElementById("login");
        	var loginBg=top.window.document.getElementById("loginBg");
        	var close=top.window.document.getElementById("close");
        	
        	var refresh = getQueryString("refresh");
        	if(refresh=="1"){
        		top.window.location.reload();
        	}

        	login.remove();
        	loginBg.remove();
        	close.remove();
		}
		$(function(){
			$('.m-con-loginBtn').click(function(){
				testForm();
			});
		});
		function testForm(){
			if(checkUsername()&&checkPwd()&&checkCode()){
				$('.m-con-tipsMessage').html("");
				loginSubmit();
			}
		}
		function loginSubmit(){
			var data=$("#login_form").serialize();
		    $.ajax({
		        type: "get",
		        url: "/webrexco/login.cgi?_r="+Math.random(),
		        data: data,
		        success: function(rslt){    
		            if(rslt.code!=0){
		                var errMsg = rslt.message||"返回数据异常,请刷新重试!";
		                $("#login_msg").html(errMsg).show();
		                return;
		            }else{
		            	var login=top.window.document.getElementById("login");
		            	var loginBg=top.window.document.getElementById("loginBg");
		            	var close=top.window.document.getElementById("close");
		            	var loginwp = top.window.document.getElementById("loginwp");
		            	var J_topUserName = top.window.document.getElementById("J_topUserName");
		            	var J_topLoginOut = top.window.document.getElementById("J_topLoginOut");
		            	J_topUserName.innerHTML=rslt.data.user.username;
		            	J_topUserName.setAttribute("href","/webrexco/uc/index.htm");
		            	J_topLoginOut.innerHTML="退出";
		            	J_topLoginOut.setAttribute("href","/webrexco/uc/data/logout.cgi");
		            	var refresh = getQueryString("refresh");
		            	if(refresh=="1"){
		            		top.window.location.reload();
		            	}
						
						top.loginComplete&&top.loginComplete();

		            	login.remove();
		            	loginBg.remove();
		            	close.remove();
		            	loginwp.remove();
		            }

				}
			});
		}
		function checkUsername(){
			var userBox = $('#login_form').find(':input').eq(0);
			username = userBox.val();
			reg = /^(\s|\t|\n|\f|\r)+$/;
			if(reg.exec(username)||undefined==username||""==username){
				userBox.siblings('.m-con-tipsMessage').html('用户名不能为空！');
				return false;
			}else{
				userBox.siblings('.m-con-tipsMessage').html('');
				return true;
			}
		}
		function checkPwd(){
			var pwdBox = $('#login_form').find(':input').eq(1);
			pwd = pwdBox.val();
			reg = /^(\s|\t|\n|\f|\r)+$/;
			if(reg.exec(pwd)||undefined==pwd||""==pwd){
				pwdBox.siblings('.m-con-tipsMessage').html('密码不能为空！');
				return false;
			}else{
				pwdBox.siblings('.m-con-tipsMessage').html('');
				return true;
			}
		}
		function checkCode(){
			var codeBox = $('#login_form').find(':input').eq(2);
			code = codeBox.val();
			reg = /^(\s|\t|\n|\f|\r)+$/;
			if(reg.exec(code)||undefined==code||""==code){
				codeBox.siblings('.m-con-tipsMessage').html('验证码不能为空！');
				return false;
			}else{
				codeBox.siblings('.m-con-tipsMessage').html('');
				return true;
			}
		}
		function getQueryString(name){
		     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
		     var r = window.location.search.substr(1).match(reg);
		     if (r!=null){
		     	var value=decodeURIComponent(r[2]);
		     	value.replace(/script|%22|%3E|%3C|'|"|>|<|\\/ig,'_');
		     	return  value;
		     }
		     return null;
		}
	</script>
</body>
</html>
