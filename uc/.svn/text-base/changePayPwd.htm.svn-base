<% include ../cfg/envpath.ejs %>
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <title>修改支付密码</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="stylesheet" href="/webrexco/static/css/cmn/common.css">
    <link rel="stylesheet" href="/webrexco/static/css/uc/common.css"/>
    <link rel="stylesheet" href="/webrexco/static/css/uc/style.css"/>
    <script type="text/javascript" src="/webrexco/static/js/cmn/rexco-0.1.min.js"></script>
    <script type="text/javascript" src="/webrexco/static/js/header.js"></script>
    <script type="text/javascript" src="/webrexco/static/js/uc/index.js"></script>
    <style type="text/css" media="screen">
        .list-tab li a{
            width:120px;
        }
        .coninput{
            width: 282px;
            height: 40px;
            line-height: 40px;
            margin: 30px 0 0 0px;
            padding-left: 15px;
            border: 1px solid #d3d3d3;
            font-size: 14px;
            border-radius: 3px;
            background: #fff;
            -webkit-box-shadow: 0 0 0px 1000px white inset !important;
        }
        .g-register{
            width:400px;
            margin:0 auto;
            margin-top: 76px;
        }
        .tips {
            position: absolute;
            font-size: 12px;
            color: #c8a676;
            line-height: 30px;
            text-indent: 15px;
            margin-left: 100px;
        }
        
        .u-password{
            padding-left: 14px;
        }
        .u-valiCode{
            padding-left: 42px;
        }
        .u-phoneCode{
            padding-left: 28px;
        }
        .u-input{
            padding-right:6px;
        }
        .proving{
            position: absolute;
            top: 30px;
            left: 273px;
            width: 118px;
            height: 40px;
            line-height: 35px;
            text-align: center;
            background: #f5f5f5;
            color: #999;
            text-decoration: none;
            border: 1px solid #d3d3d3;
            border-radius: 3px;
            font-size: 16px;
        }
        .proving img{
            width: 100%;
            height:100%;
        }
        .short {
            width: 154px;
            height: 40px;
        }
        .submit {
            cursor: pointer;
            width: 300px;
            height: 42px;
            line-height: 42px;
            margin-top:28px;
            margin-bottom: 20px;
            text-align: center;
            background: #c8a676;
            font-size: 20px;
            color: #fff;
            letter-spacing: 4px;
            border-radius: 3px;
            margin-left: 95px;
        }
        .checkbox{
            width: 18px;
            height: 18px;
            opacity: 0;
            position: absolute;
            left: -16px;
            top: -26px;
        }
        .protocol {
            position: absolute;
            clear: both;
            width: 200px;
            margin-left: 16px;
            margin-top: -5px;
        }
        .entry-icon{
            width: 14px;
            height: 14px;
            background-size: 100px 100px;
            display: block;
            position: absolute;
            top: 5px;
            left: -18px;
        }
        .protocol a{
            color: #999;
            font-size: 14px;
        }
        .uncheck{
             background: url(/webrexco/static/img/uc/icon.png) no-repeat -19px 0px;
            
        }
        .check{
           background: url(/webrexco/static/img/uc/icon.png) no-repeat -36px 0px;
        }
    </style>
    <script type="text/javascript">
        window.tplObj={
            "data":{
                "menuMap":{"0":0}
            }
        };
    </script>
</head>
<body style="background:#fff;height: 120%;">
    <% include ../cmn/header.ejs %>
    <% include ../cmn/user_banner.ejs %> 
          <div class="m-con clearfix">
        <div class="m-leftNav">
            <% include ../cmn/user_left.ejs %>
        </div>
        <div class="user_right"> 
            <div class="user_right_menu">
                <ul id="tab" class="list-tab clearfix">
                    <li class="tabactive">
                        <a class="titleover">支付密码修改</a> 
                    </li>
                </ul>
            </div>
            <div class="g-register">
                <form id="payForm">
                    <div class="f-pr">
                        <span class="u-password u-input">新支付密码</span>
                        <input type="password" name="paypassword" id="paypassword" placeholder="请输入支付密码" class="coninput">
                        <div class="tips">
                            <span></span>
                        </div>
                    </div>
                    <div class="f-pr">
                        <span class="u-input">确认支付密码</span>
                        <input type="password" name="payAgain" id="payAgain" placeholder="确认新支付密码" class="coninput">
                        <div class="tips">
                            <span></span>
                    </div>
                    </div>
                    <div class="f-pr">
                        <span class="u-valiCode u-input">验证码</span>
                        <input type="text" name="valiCode" id="valiCode" placeholder="请输入图形验证码" class="short coninput">
                        <a href="javascript:;" class="proving"><img id="validimg" class="codeimg" src="login.cci?w=160&amp;h=40&amp;f=34&amp;o=60&amp;q=60" alt="点击刷新" onclick="this.src='login.cci?w=160&amp;h=40&amp;f=34&amp;o=60&amp;q=60&amp;t=' + Math.random();" align="absmiddle"></a>
                        <div class="tips">
                            <span></span>
                        </div>
                    </div>
                    <div class="f-pr">
                        <span class="u-phoneCode u-input">短信验证</span>
                        <input type="text" name="phoneCode" id="phoneCode" placeholder="请输入手机验证码" class="short coninput">
                        <a href="javascript:;" class="valcode proving">短信验证码</a>
                        <div class="tips">
                            <span></span>
                        </div>
                    </div>
                    <div class="submit J_btnSubmit">确认提交</div>
                </form>
            </div>
        </div>    
    </div>
    <% include ../cmn/footer.ejs %>
    <script type="text/javascript">
    $(function(){
        $(".f-pr input").mousedown(function(){
            $(this).css('border', '1px solid #c8a676');
            $(this).css('background-color', '#fff');
        });
        $(".f-pr input").blur(function(){
            $(this).css('border', '1px solid #d3d3d3');
            $(this).css('background-color', '#fff');
        });
        $("#paypassword").blur(function(){
            checkPassword('#paypassword');
        });
        $("#paypassword").keyup(function(){
            checkPassword('#paypassword');
        });
        //当重新输入密码
        $("#payAgain").blur(function(){
            newinto();
        });
         $("#payAgain").keyup(function(){
            newinto();
        });
        //图形验证码
        $('#valiCode').keyup(function(){
            var verif=this.value;
            if(verif.length==4){
                checkVerifyCode();
            }
        });
        $('#valiCode').blur(function(){
            checkVerifyCode();
        });
        $("#validimg").click(function(){
            $('#valiCode').val("");
        });
       $('#phoneCode').keyup(function(){
            var verif=this.value;
            if(verif.length==6){
                $("#phoneCode").siblings(".tips").children("span").html("");
            }
        });
        $('#phoneCode').blur(function(){
            var verif=this.value;
            if(verif.length==6){
                $("#phoneCode").siblings(".tips").children("span").html("");
            }
        });
        // 获取短信验证码
        $('.valcode').click(function(){
            if($(this).html().indexOf('验证码')>0){
                $("#phoneCode").val("");
                checkPassword('#paypassword');
                checkVerifyCode();
                var paypassword=$('#paypassword').val(),
                    verifyCode =$("#valiCode").val();
                if(($("#paypassword").siblings(".tips").children("span").html().length>0)||($("#valiCode").siblings(".tips").children("span").html().length>0 )){
                    return;
                }
                sendPhoneCode();
                
            }
        });
        $(".J_btnSubmit").click(function(){
            checkPassword('#paypassword');
            if(($("#paypassword").siblings(".tips").children("span").html().length==0)&&($("#phoneCode").val()!="")&&($("#phoneCode").val()!=undefined) ){
               paySubmit(); 
            }
        });
    });
        //获取验证码js
        function sendPhoneCode(){
            var data =  {
                "type":5
            };
            $.ajax({
                type: "get",
                url:"/webrexco/phoneCodeApp.cgi",
                data:data,
                cache:false,
                success: function(rslt){
                    if (rslt.code!=0) {
                        var errMsg = rslt.message||"返回数据异常,请刷新重试!";
                        $("#phoneCode").siblings(".tips").children("span").html(errMsg);
                    }
                    $("#phoneCode").siblings(".tips").children("span").html(rslt.message);
                    var cd = 60;
                    $(".valcode").html(cd +'s');
                    countDown(cd);
                }
            });
        }
        //注册图形验证码
        function checkVerifyCode(){
            var verifyCode =$('#valiCode').val();
            if(undefined == verifyCode||"" == verifyCode){
                $('#valiCode').siblings(".tips").children("span").html("验证码输入错误");
                return;
            }
            var data={
                "verifyCode":verifyCode
            };
            $.ajax({
                type: "get",
                url:"/webrexco/regist/checkVerifyCode.cgi",
                data:data,
                cache:false,
                success:function(rslt){
                    if(rslt.code!=0){//图形验证码错误,验证码刷新
                        $('#valiCode').siblings(".tips").children("span").html("验证码输入错误");
                        $('#validimg').attr('src',"login.cci?w=160&h=40&f=34&o=60&q=60&t=" + Math.random());//验证失败验证码刷新
                        $('#valiCode').val("");
                    }else{
                        $('#valiCode').siblings(".tips").children().html("");
                    }
                }
            });
        }
        function paySubmit(){
            var data=$("#payForm").serialize();
            $.ajax({
                type:"get",
                url:'/webrexco/uc/data/payPassWord.cgi',
                data:data,
                cache:false,
                success:function(rslt){
                    if(rslt.code==401){
                        baseModel.errorCode(rslt.code,rslt.message);
                        return;
                    }else if(rslt.code==0){
                        util.tipsModal(2,'支付密码修改成功!');
                        setTimeout(function(){location.href='/webrexco/uc/account.htm';},3000);
                        return;
                    }else{
                        var errMsg = rslt.message||"返回数据异常,请刷新重试!";
                        util.tipsModal(2,errMsg);
                        $('#validimg').attr('src',"login.cci?w=160&h=40&f=34&o=60&q=60&t=" + Math.random());
                        return;
                    }
                }
            })
        }
        //验证码倒计时
        function countDown(cd){
            var cd =cd || 60;
            timer =setInterval(function(){
                if(cd>0){
                    $('.valcode').text((--cd) +'s');
                }else{
                    window.clearInterval(timer);
                    $('.valcode').html('获取验证码');
                }
            },1000);
        }
        function newinto(){
            var reg=/^\d{6}$/; 
            var payAgain=$('#payAgain').val();
            var paypassword=$('#paypassword').val();
            if(payAgain==''||undefined==payAgain){
                $('#payAgain').siblings(".tips").children("span").html("支付密码不能为空");
            }else if(!reg.test(payAgain)){
                $('#payAgain').siblings(".tips").children("span").html("请输入6位数字的支付密码");
            }else if(payAgain!=paypassword){
                $('#payAgain').siblings(".tips").children("span").html('两次输入密码不一致');
            }else{
                $('#payAgain').siblings(".tips").children("span").html("");
            }
        }
        //检查密码格式
        function checkPassword(value){
            var reg=/^\d{6}$/; 
            var newpaywsd=$(value).val();
            if(newpaywsd==''||undefined==newpaywsd){
                $('#paypassword').siblings(".tips").children("span").html("支付密码不能为空");
            }else if(!reg.test(newpaywsd)){
                $('#paypassword').siblings(".tips").children("span").html("请输入6位数字的支付密码");
            }else{
                $('#paypassword').siblings(".tips").children("span").html("");
            }
        }
    </script>
</body>
</html>
